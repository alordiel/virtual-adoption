## Developer's Notes

### Scripts and styles
The scripts and styles needed for this plugin are only loaded on the page where they are needed. There are restrictions by post-type, taxonomy, etc. to make sure that the whole site is not kept clean for scripts that are not needed. See `./include/enqueue-scripts-and-styles.php` for more details.

### What will happen with activation of the plugin?
Once the plugin is activated some pre-set-up functions will be triggered. A new database will be added (`{wp-prefix}va_subscriptions`), which will be used for storing details about the subscriptions and some PayPal related data.

Few pages will be autogenerated ("Thank you" page, "Checkout" page, "Login" page, "My subscriptions" page). The related to them template files will be connected.

Two log files will be created in `./wp-content/uploads/virtual-adoptions/`. On that will keep records of successful events and one that will track the error logs.

Three new post types will be created. Pending, Active and Cancelled statuses will be related to the subscriptions and their state.

### CSS
The CSS is build from SCSS with gulp. To make it all work for you navigate to `./assets/build/` folder in the console/terminal and install the required packages with `npm i`. To run the compilation of the SCSS type `gulp` in the same folder. There is a `watcher` set up and any change of the CSS files will trigger the compiler. For more info check the `gulpfile.js`.

### PayPal
Adding and storing the PayPal secret key and client ID will also create a webhook on PayPal's account that will be pointed to the endpoint `/wp-json/virtual-adoptions/v1/subscription/`. It will listen for events triggered from PayPal related to reactivating, renewing and cancelling the subscription. These triggers will mostly update the database of the subscriptions with the correct post status and the count of the completed cycles. For more details see the `./include/webhooks.php` file.

### Roles
There is a new role added - `Virtual adopter`. It has the same capabilities as `subscriber`. 
### TODO
* Allow developers to create their own templates from their own themes and replace the one we have currently
* Remove the PayPal plans and PayPal subscriptions post types from `wp_posts`. For the first one we can use a single `wp_options` entry, for the second one we can use the current `wp_va_subscriptions` table
* Re-style and restructure the settings to be under on main menu element where we can have the settings, the plans, the subscriptions. This can be done with Veu or React to make it more intuitive and reactive.
* Few of the texts are still hardcoded (like the steps of the virtual donations) which should be done in different way (dynamic one).
* Add payment gates so more payment methods would be possible
* Add WP hooks and filters